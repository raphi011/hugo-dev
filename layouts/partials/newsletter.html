<div class="not-prose my-8 rounded-lg border border-ctp-surface0 bg-ctp-mantle p-6">
  <h3 class="mt-0 mb-2 text-lg font-semibold text-ctp-text">Subscribe to the newsletter</h3>
  <p class="mb-4 text-sm text-ctp-subtext0">Get notified when I publish new posts. No spam.</p>
  <form class="newsletter-form flex gap-2" onsubmit="return false;">
    <input
      type="email"
      required
      placeholder="you@example.com"
      class="flex-1 rounded-md border border-ctp-surface1 bg-ctp-base px-3 py-2 text-sm text-ctp-text placeholder:text-ctp-overlay0 focus:border-ctp-blue focus:outline-none"
    >
    <button
      type="submit"
      class="rounded-md bg-ctp-blue px-4 py-2 text-sm font-medium text-ctp-base hover:opacity-90 transition-opacity cursor-pointer"
    >
      Subscribe
    </button>
  </form>
  <p class="newsletter-msg mt-3 hidden text-sm"></p>
</div>
<script>
(function() {
  var form = document.currentScript.previousElementSibling.querySelector('.newsletter-form');
  var msg = document.currentScript.previousElementSibling.querySelector('.newsletter-msg');
  var action = {{ with site.Params.newsletterAction }}"{{ . }}"{{ else }}""{{ end }};
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    var email = form.querySelector('input[type="email"]').value;
    if (!action) {
      msg.textContent = 'Newsletter coming soon! Thanks for your interest.';
      msg.className = 'newsletter-msg mt-3 text-sm text-ctp-green';
      return;
    }
    fetch(action, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({email: email})
    }).then(function(r) {
      if (r.ok) {
        msg.textContent = 'Subscribed! Check your inbox.';
        msg.className = 'newsletter-msg mt-3 text-sm text-ctp-green';
        form.reset();
      } else {
        msg.textContent = 'Something went wrong. Please try again.';
        msg.className = 'newsletter-msg mt-3 text-sm text-ctp-red';
      }
    }).catch(function() {
      msg.textContent = 'Something went wrong. Please try again.';
      msg.className = 'newsletter-msg mt-3 text-sm text-ctp-red';
    });
  });
})();
</script>
